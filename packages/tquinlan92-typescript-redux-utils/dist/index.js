"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var lodash_1 = require("lodash");
var typescript_fsa_1 = require("typescript-fsa");
function createReducer(initialState, actions) {
    return function (state, incomingAction) {
        if (state === void 0) { state = initialState; }
        var actionMatch = lodash_1.find(actions, function (action) {
            return typescript_fsa_1.isType(incomingAction, action.actionCreator);
        });
        if (actionMatch) {
            return actionMatch.reducer(state, incomingAction.payload);
        }
        else {
            return state;
        }
    };
}
exports.createReducer = createReducer;
function makeActionCreatorWithReducer(name, reducer) {
    var SimpleActionCreator = typescript_fsa_1.default();
    return {
        actionCreator: SimpleActionCreator(name),
        reducer: reducer
    };
}
exports.makeActionCreatorWithReducer = makeActionCreatorWithReducer;
function getCreators(creators) {
    return lodash_1.mapValues(creators, "actionCreator");
}
exports.getCreators = getCreators;
function makeActionCreatorWithReducerWithPrefix(actionName, reducer) {
    return function (reducerName) { return makeActionCreatorWithReducer(JSON.stringify({ reducerName: reducerName, actionName: actionName }), reducer); };
}
exports.makeActionCreatorWithReducerWithPrefix = makeActionCreatorWithReducerWithPrefix;
function getReducersFromCombinedActionReducer(creators) {
    return lodash_1.mapValues(creators, "reducer");
}
exports.getReducersFromCombinedActionReducer = getReducersFromCombinedActionReducer;
function getActionsFromCombinedActionReducer(creators) {
    return lodash_1.mapValues(creators, "actions");
}
exports.getActionsFromCombinedActionReducer = getActionsFromCombinedActionReducer;
function getActionsAndReducersFromCombinedActionReducer(creators) {
    return {
        actions: getActionsFromCombinedActionReducer(creators),
        reducers: getReducersFromCombinedActionReducer(creators)
    };
}
exports.getActionsAndReducersFromCombinedActionReducer = getActionsAndReducersFromCombinedActionReducer;
function testRunner(reducer) {
    return function (initalState, action) {
        return reducer(initalState, action);
    };
}
exports.testRunner = testRunner;
function makeSimpleReducer(reducerName, initialState) {
    var actions = lodash_1.mapValues(initialState, function (propertyFromState, key) {
        var creatorReducer = makeActionCreatorWithReducerWithPrefix("UPDATE_" + key.toUpperCase(), function (state, newValue) {
            var _a;
            return lodash_1.assign({}, state, (_a = {}, _a[key] = newValue, _a));
        });
        return creatorReducer(reducerName);
    });
    var reset = makeActionCreatorWithReducerWithPrefix("RESET", function () {
        return initialState;
    })(reducerName);
    var setAll = makeActionCreatorWithReducerWithPrefix("SET_ALL", function (state, newValue) {
        return newValue;
    })(reducerName);
    var set = makeActionCreatorWithReducerWithPrefix("SET", function (state, newStateValues) {
        return lodash_1.assign({}, state, newStateValues);
    })(reducerName);
    return {
        actions: lodash_1.assign({}, getCreators(lodash_1.assign({}, actions, { reset: reset, setAll: setAll, set: set }))),
        reducer: createReducer(initialState, lodash_1.assign({}, actions, { reset: reset, setAll: setAll, set: set })),
    };
}
exports.makeSimpleReducer = makeSimpleReducer;
function makeNestedSimpleReducer(state) {
    return lodash_1.mapValues(state, function (value, key) {
        return makeSimpleReducer(key, value);
    });
}
exports.makeNestedSimpleReducer = makeNestedSimpleReducer;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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aWduLCBEaWN0aW9uYXJ5IH0gZnJvbSAnbG9kYXNoJztcbmltcG9ydCBhY3Rpb25DcmVhdG9yRmFjdG9yeSwgeyBpc1R5cGUsIEFjdGlvbiwgQW55QWN0aW9uLCBBY3Rpb25DcmVhdG9yIH0gZnJvbSBcInR5cGVzY3JpcHQtZnNhXCI7XG5pbXBvcnQgeyBSZWR1Y2VyIH0gZnJvbSAncmVkdXgnO1xuXG5leHBvcnQgeyBBY3Rpb24sIEFueUFjdGlvbiwgQWN0aW9uQ3JlYXRvciB9O1xuXG5leHBvcnQgaW50ZXJmYWNlIEFjdGlvbkNyZWF0b3JXaXRoUmVkdWNlcjxTdGF0ZVR5cGU+IHtcbiAgICBhY3Rpb25DcmVhdG9yOiBBY3Rpb25DcmVhdG9yPGFueT47XG4gICAgcmVkdWNlcjogKHN0YXRlOiBTdGF0ZVR5cGUsIGFjdGlvbjogYW55KSA9PiBTdGF0ZVR5cGU7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQWN0aW9uQ3JlYXRvcldpdGhSZWR1Y2VyR3JvdXA8U3RhdGVUeXBlPiB7XG4gICAgW2tleTogc3RyaW5nXTogQWN0aW9uQ3JlYXRvcldpdGhSZWR1Y2VyPFN0YXRlVHlwZT47XG59XG4gXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlUmVkdWNlcjxTdGF0ZVR5cGU+KGluaXRpYWxTdGF0ZTogU3RhdGVUeXBlLCBhY3Rpb25zOiBBY3Rpb25DcmVhdG9yV2l0aFJlZHVjZXJHcm91cDxTdGF0ZVR5cGU+KSB7XG4gICAgcmV0dXJuIChzdGF0ZTogU3RhdGVUeXBlID0gaW5pdGlhbFN0YXRlLCBpbmNvbWluZ0FjdGlvbjogQWN0aW9uPEFueUFjdGlvbj4pOiBTdGF0ZVR5cGUgPT4ge1xuICAgICAgICBjb25zdCBhY3Rpb25NYXRjaCA9IGZpbmQoYWN0aW9ucywgYWN0aW9uID0+IHtcbiAgICAgICAgICAgIHJldHVybiBpc1R5cGUoaW5jb21pbmdBY3Rpb24sIGFjdGlvbi5hY3Rpb25DcmVhdG9yKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChhY3Rpb25NYXRjaCkge1xuICAgICAgICAgICAgcmV0dXJuIGFjdGlvbk1hdGNoLnJlZHVjZXIoc3RhdGUsIGluY29taW5nQWN0aW9uLnBheWxvYWQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHN0YXRlO1xuICAgICAgICB9XG4gICAgfTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBTdGF0ZVR5cGVSZWR1Y2VyPFN0YXRlVHlwZSwgQWN0aW9uUGFyYW1zPiB7XG4gICAgKHN0YXRlOiBTdGF0ZVR5cGUsIGFjdGlvbjogQWN0aW9uUGFyYW1zKTogU3RhdGVUeXBlO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gbWFrZUFjdGlvbkNyZWF0b3JXaXRoUmVkdWNlcjxTdGF0ZVR5cGUsIEFjdGlvblBhcmFtcz4obmFtZTogc3RyaW5nLCByZWR1Y2VyOiBTdGF0ZVR5cGVSZWR1Y2VyPFN0YXRlVHlwZSwgQWN0aW9uUGFyYW1zPikge1xuICAgIGNvbnN0IFNpbXBsZUFjdGlvbkNyZWF0b3IgPSBhY3Rpb25DcmVhdG9yRmFjdG9yeSgpO1xuICAgIHJldHVybiB7XG4gICAgICAgIGFjdGlvbkNyZWF0b3I6IFNpbXBsZUFjdGlvbkNyZWF0b3I8QWN0aW9uUGFyYW1zPihuYW1lKSxcbiAgICAgICAgcmVkdWNlclxuICAgIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRDcmVhdG9yczxUIGV4dGVuZHMgeyBba2V5OiBzdHJpbmddOiBBY3Rpb25DcmVhdG9yV2l0aFJlZHVjZXI8YW55PiB9PihjcmVhdG9yczogVCk6IHsgW1AgaW4ga2V5b2YgVF06IFRbUF1bJ2FjdGlvbkNyZWF0b3InXSB9IHtcbiAgICByZXR1cm4gbWFwVmFsdWVzKGNyZWF0b3JzLCBcImFjdGlvbkNyZWF0b3JcIikgYXMgeyBbUCBpbiBrZXlvZiBUXTogVFtQXVsnYWN0aW9uQ3JlYXRvciddIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBtYWtlQWN0aW9uQ3JlYXRvcldpdGhSZWR1Y2VyV2l0aFByZWZpeDxTdGF0ZVR5cGUsIEFjdGlvblBhcmFtcz4oYWN0aW9uTmFtZTogc3RyaW5nLCByZWR1Y2VyOiBTdGF0ZVR5cGVSZWR1Y2VyPFN0YXRlVHlwZSwgQWN0aW9uUGFyYW1zPikge1xuICAgIHJldHVybiAocmVkdWNlck5hbWU/OiBzdHJpbmcpID0+IG1ha2VBY3Rpb25DcmVhdG9yV2l0aFJlZHVjZXI8U3RhdGVUeXBlLCBBY3Rpb25QYXJhbXM+KEpTT04uc3RyaW5naWZ5KHsgcmVkdWNlck5hbWUsIGFjdGlvbk5hbWUgfSksIHJlZHVjZXIpO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFNpbXBsZUFuZFRodW5rQWN0aW9ucyB7XG4gICAgW2tleTogc3RyaW5nXTogYW55O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEFjdGlvbnNBbmRSZWR1Y2VyIHtcbiAgICBhY3Rpb25zPzogU2ltcGxlQW5kVGh1bmtBY3Rpb25zO1xuICAgIHJlZHVjZXI/OiBSZWR1Y2VyPGFueSwgQW55QWN0aW9uPjtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldFJlZHVjZXJzRnJvbUNvbWJpbmVkQWN0aW9uUmVkdWNlcjxUIGV4dGVuZHMgeyBba2V5OiBzdHJpbmddOiBBY3Rpb25zQW5kUmVkdWNlciB9PihjcmVhdG9yczogVCk6IHsgW1AgaW4ga2V5b2YgVF06IFRbUF1bJ3JlZHVjZXInXSB9IHtcbiAgICByZXR1cm4gbWFwVmFsdWVzKGNyZWF0b3JzLCBcInJlZHVjZXJcIikgYXMgeyBbUCBpbiBrZXlvZiBUXTogVFtQXVsncmVkdWNlciddIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRBY3Rpb25zRnJvbUNvbWJpbmVkQWN0aW9uUmVkdWNlcjxUIGV4dGVuZHMgeyBba2V5OiBzdHJpbmddOiBBY3Rpb25zQW5kUmVkdWNlciB9PihjcmVhdG9yczogVCk6IHsgW1AgaW4ga2V5b2YgVF06IFRbUF1bJ2FjdGlvbnMnXSB9IHtcbiAgICByZXR1cm4gbWFwVmFsdWVzKGNyZWF0b3JzLCBcImFjdGlvbnNcIikgYXMgeyBbUCBpbiBrZXlvZiBUXTogVFtQXVsnYWN0aW9ucyddIH07XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQWN0aW9uc0FuZFJlZHVjZXJTZXR1cCB7XG4gICAgW2tleTogc3RyaW5nXTogQWN0aW9uc0FuZFJlZHVjZXI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQWN0aW9uc1JlZHVjZXJzRnJvbUNvbWJpbmVkQWN0aW9uUmVkdWNlcjxBY3Rpb25zUmVkdWNlcnNJbnN0YW5jZXMgZXh0ZW5kcyBBY3Rpb25zQW5kUmVkdWNlclNldHVwPiB7XG4gICAgYWN0aW9uczogeyBbUCBpbiBrZXlvZiBBY3Rpb25zUmVkdWNlcnNJbnN0YW5jZXNdOiBBY3Rpb25zUmVkdWNlcnNJbnN0YW5jZXNbUF1bJ2FjdGlvbnMnXSB9O1xuICAgIHJlZHVjZXJzOiB7IFtQIGluIGtleW9mIEFjdGlvbnNSZWR1Y2Vyc0luc3RhbmNlc106IEFjdGlvbnNSZWR1Y2Vyc0luc3RhbmNlc1tQXVsncmVkdWNlciddIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRBY3Rpb25zQW5kUmVkdWNlcnNGcm9tQ29tYmluZWRBY3Rpb25SZWR1Y2VyPENyZWF0b3JzIGV4dGVuZHMgQWN0aW9uc0FuZFJlZHVjZXJTZXR1cD4oY3JlYXRvcnM6IENyZWF0b3JzKTogQWN0aW9uc1JlZHVjZXJzRnJvbUNvbWJpbmVkQWN0aW9uUmVkdWNlcjxDcmVhdG9ycz4ge1xuICAgIHJldHVybiB7XG4gICAgICAgIGFjdGlvbnM6IGdldEFjdGlvbnNGcm9tQ29tYmluZWRBY3Rpb25SZWR1Y2VyKGNyZWF0b3JzKSBhcyB7IFtQIGluIGtleW9mIENyZWF0b3JzXTogQ3JlYXRvcnNbUF1bJ2FjdGlvbnMnXSB9LFxuICAgICAgICByZWR1Y2VyczogZ2V0UmVkdWNlcnNGcm9tQ29tYmluZWRBY3Rpb25SZWR1Y2VyKGNyZWF0b3JzKSBhcyB7IFtQIGluIGtleW9mIENyZWF0b3JzXTogQ3JlYXRvcnNbUF1bJ3JlZHVjZXInXSB9XG4gICAgfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHRlc3RSdW5uZXI8UmVkdWNlclN0YXRlPihyZWR1Y2VyOiBSZWR1Y2VyKSB7XG4gICAgcmV0dXJuIChpbml0YWxTdGF0ZTogUmVkdWNlclN0YXRlLCBhY3Rpb246IEFueUFjdGlvbikgPT4ge1xuICAgICAgICByZXR1cm4gcmVkdWNlcihpbml0YWxTdGF0ZSwgYWN0aW9uKTtcbiAgICB9O1xufVxuXG50eXBlIFBhcnRpYWw8VD4gPSB7XG4gICAgW1AgaW4ga2V5b2YgVF0/OiBUW1BdO1xufTtcblxuZXhwb3J0IGZ1bmN0aW9uIG1ha2VTaW1wbGVSZWR1Y2VyPFN0YXRlIGV4dGVuZHMge30+KHJlZHVjZXJOYW1lOiBzdHJpbmcsIGluaXRpYWxTdGF0ZTogU3RhdGUpIHtcbiAgICBjb25zdCBhY3Rpb25zID0gbWFwVmFsdWVzKGluaXRpYWxTdGF0ZSwgKHByb3BlcnR5RnJvbVN0YXRlLCBrZXk6IGtleW9mIFN0YXRlKSA9PiB7XG4gICAgICAgIGNvbnN0IGNyZWF0b3JSZWR1Y2VyID0gbWFrZUFjdGlvbkNyZWF0b3JXaXRoUmVkdWNlcldpdGhQcmVmaXg8U3RhdGUsIFN0YXRlW3R5cGVvZiBrZXldPihcbiAgICAgICAgICAgIGBVUERBVEVfJHtrZXkudG9VcHBlckNhc2UoKX1gLFxuICAgICAgICAgICAgKHN0YXRlLCBuZXdWYWx1ZSkgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiBhc3NpZ24oe30sIHN0YXRlLFxuICAgICAgICAgICAgICAgICAgICB7W2tleV06IG5ld1ZhbHVlfVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgICAgIHJldHVybiBjcmVhdG9yUmVkdWNlcihyZWR1Y2VyTmFtZSkgYXMgYW55O1xuICAgIH0pIGFzIHtcbiAgICAgICAgW1AgaW4ga2V5b2YgU3RhdGVdOiB7XG4gICAgICAgICAgICBhY3Rpb25DcmVhdG9yOiBBY3Rpb25DcmVhdG9yPFN0YXRlW1BdPjtcbiAgICAgICAgICAgIHJlZHVjZXI6IFN0YXRlVHlwZVJlZHVjZXI8U3RhdGUsIFN0YXRlW1BdPjtcbiAgICAgICAgfVxuICAgIH07XG4gICAgY29uc3QgcmVzZXQgPSBtYWtlQWN0aW9uQ3JlYXRvcldpdGhSZWR1Y2VyV2l0aFByZWZpeDxTdGF0ZSwgbnVsbD4oXG4gICAgICAgIGBSRVNFVGAsXG4gICAgICAgICgpID0+IHtcbiAgICAgICAgICAgIHJldHVybiBpbml0aWFsU3RhdGU7XG4gICAgICAgIH1cbiAgICApKHJlZHVjZXJOYW1lKTtcbiAgICBjb25zdCBzZXRBbGwgPSBtYWtlQWN0aW9uQ3JlYXRvcldpdGhSZWR1Y2VyV2l0aFByZWZpeDxTdGF0ZSwgU3RhdGU+KFxuICAgICAgICBgU0VUX0FMTGAsXG4gICAgICAgIChzdGF0ZSwgbmV3VmFsdWUpID0+IHtcbiAgICAgICAgICAgIHJldHVybiBuZXdWYWx1ZTtcbiAgICAgICAgfVxuICAgICkocmVkdWNlck5hbWUpO1xuICAgIGNvbnN0IHNldCA9IG1ha2VBY3Rpb25DcmVhdG9yV2l0aFJlZHVjZXJXaXRoUHJlZml4PFN0YXRlLCBQYXJ0aWFsPFN0YXRlPj4oXG4gICAgICAgIGBTRVRgLFxuICAgICAgICAoc3RhdGUsIG5ld1N0YXRlVmFsdWVzKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gYXNzaWduKHt9LCBcbiAgICAgICAgICAgICAgICBzdGF0ZSxcbiAgICAgICAgICAgICAgICBuZXdTdGF0ZVZhbHVlc1xuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICkocmVkdWNlck5hbWUpO1xuICAgIHJldHVybiB7XG4gICAgICAgIGFjdGlvbnM6IGFzc2lnbih7fSwgXG4gICAgICAgICAgICBnZXRDcmVhdG9ycyhhc3NpZ24oe30sIGFjdGlvbnMsIHtyZXNldCwgc2V0QWxsLCBzZXR9KSksXG4gICAgICAgICksXG4gICAgICAgIHJlZHVjZXI6IGNyZWF0ZVJlZHVjZXI8U3RhdGU+KGluaXRpYWxTdGF0ZSwgYXNzaWduKHt9LCBhY3Rpb25zLCB7cmVzZXQsIHNldEFsbCwgc2V0fSkpLFxuICAgIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBtYWtlTmVzdGVkU2ltcGxlUmVkdWNlcjxBU3RhdGU+KHN0YXRlOiBEaWN0aW9uYXJ5PHt9Pikge1xuICAgIHJldHVybiBtYXBWYWx1ZXMoc3RhdGUsICh2YWx1ZSwga2V5KSA9PiB7XG4gICAgICAgIHJldHVybiBtYWtlU2ltcGxlUmVkdWNlcihrZXksIHZhbHVlKSBhcyBhbnk7XG4gICAgfSkgYXMge1xuICAgICAgICAgICAgW1AgaW4ga2V5b2YgQVN0YXRlXToge1xuICAgICAgICAgICAgICAgIHJlZHVjZXI6IFJlZHVjZXI8QVN0YXRlW1BdLCBBbnlBY3Rpb24+LFxuICAgICAgICAgICAgICAgIGFjdGlvbnM6IHtcbiAgICAgICAgICAgICAgICAgICAgW0EgaW4ga2V5b2YgQVN0YXRlW1BdXTogQWN0aW9uQ3JlYXRvcjxBU3RhdGVbUF1bQV0+XG4gICAgICAgICAgICAgICAgfSAmIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzZXQ6IEFjdGlvbkNyZWF0b3I8bnVsbD47XG4gICAgICAgICAgICAgICAgICAgIHNldEFsbDogQWN0aW9uQ3JlYXRvcjxBU3RhdGVbUF0+O1xuICAgICAgICAgICAgICAgICAgICBzZXQ6IEFjdGlvbkNyZWF0b3I8UGFydGlhbDxBU3RhdGVbUF0+PjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbn1cbiJdfQ==
