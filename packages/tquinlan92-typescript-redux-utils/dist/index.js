"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var lodash_1 = require("lodash");
var typescript_fsa_1 = require("typescript-fsa");
function createReducer(initialState, actions) {
    return function (state, incomingAction) {
        if (state === void 0) { state = initialState; }
        var actionMatch = lodash_1.find(actions, function (action) {
            return typescript_fsa_1.isType(incomingAction, action.actionCreator);
        });
        if (actionMatch) {
            return actionMatch.reducer(state, incomingAction.payload);
        }
        else {
            return state;
        }
    };
}
exports.createReducer = createReducer;
function makeActionCreatorWithReducer(name, reducer) {
    var SimpleActionCreator = typescript_fsa_1.default();
    return {
        actionCreator: SimpleActionCreator(name),
        reducer: reducer
    };
}
exports.makeActionCreatorWithReducer = makeActionCreatorWithReducer;
function getCreators(creators) {
    return lodash_1.mapValues(creators, "actionCreator");
}
exports.getCreators = getCreators;
function makeActionCreatorWithReducerWithPrefix(actionName, reducer) {
    return function (reducerName) { return makeActionCreatorWithReducer(JSON.stringify({ reducerName: reducerName, actionName: actionName }), reducer); };
}
exports.makeActionCreatorWithReducerWithPrefix = makeActionCreatorWithReducerWithPrefix;
function getReducersFromCombinedActionReducer(creators) {
    return lodash_1.mapValues(creators, "reducer");
}
exports.getReducersFromCombinedActionReducer = getReducersFromCombinedActionReducer;
function getActionsFromCombinedActionReducer(creators) {
    return lodash_1.mapValues(creators, "actions");
}
exports.getActionsFromCombinedActionReducer = getActionsFromCombinedActionReducer;
function getActionsAndReducersFromCombinedActionReducer(creators) {
    return {
        actions: getActionsFromCombinedActionReducer(creators),
        reducers: getReducersFromCombinedActionReducer(creators)
    };
}
exports.getActionsAndReducersFromCombinedActionReducer = getActionsAndReducersFromCombinedActionReducer;
function testRunner(reducer) {
    return function (initalState, action) {
        return reducer(initalState, action);
    };
}
exports.testRunner = testRunner;
function makeSimpleReducer(name, initialState) {
    var reducerName = name ? name : 'random';
    var actions = lodash_1.mapValues(initialState, function (propertyFromState, key) {
        var creatorReducer = makeActionCreatorWithReducerWithPrefix("UPDATE_" + key.toUpperCase(), function (state, newValue) {
            var _a;
            return lodash_1.assign({}, state, (_a = {}, _a[key] = newValue, _a));
        });
        return creatorReducer(reducerName);
    });
    var reset = makeActionCreatorWithReducerWithPrefix("RESET", function () {
        return initialState;
    })(reducerName);
    var setAll = makeActionCreatorWithReducerWithPrefix("SET_ALL", function (state, newValue) {
        return newValue;
    })(reducerName);
    return {
        actions: lodash_1.assign({}, getCreators(lodash_1.assign({}, actions, { reset: reset, setAll: setAll }))),
        reducer: createReducer(initialState, lodash_1.assign({}, actions, { reset: reset, setAll: setAll }))
    };
}
exports.makeSimpleReducer = makeSimpleReducer;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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QU8sY0FBYyxDQUFDLFdBQVcsQ0FBUSxDQUFDO0lBQzlDLENBQUMsQ0FLQSxDQUFDO0lBQ0YsSUFBTSxLQUFLLEdBQUcsc0NBQXNDLENBQ2hELE9BQU8sRUFDUDtRQUNJLE9BQU8sWUFBWSxDQUFDO0lBQ3hCLENBQUMsQ0FDSixDQUFDLFdBQVcsQ0FBQyxDQUFDO0lBQ2YsSUFBTSxNQUFNLEdBQUcsc0NBQXNDLENBQ2pELFNBQVMsRUFDVCxVQUFDLEtBQUssRUFBRSxRQUFRO1FBQ1osT0FBTyxRQUFRLENBQUM7SUFDcEIsQ0FBQyxDQUNKLENBQUMsV0FBVyxDQUFDLENBQUM7SUFDZixPQUFPO1FBQ0gsT0FBTyxFQUFFLGVBQU0sQ0FBQyxFQUFFLEVBQ2QsV0FBVyxDQUFDLGVBQU0sQ0FBQyxFQUFFLEVBQUUsT0FBTyxFQUFFLEVBQUMsS0FBSyxPQUFBLEVBQUUsTUFBTSxRQUFBLEVBQUMsQ0FBQyxDQUFDLENBQ3BEO1FBQ0QsT0FBTyxFQUFFLGFBQWEsQ0FBUSxZQUFZLEVBQUUsZUFBTSxDQUFDLEVBQUUsRUFBRSxPQUFPLEVBQUUsRUFBQyxLQUFLLE9BQUEsRUFBRSxNQUFNLFFBQUEsRUFBQyxDQUFDLENBQUM7S0FDcEYsQ0FBQztBQUNOLENBQUM7QUFwQ0QsOENBb0NDIiwiZmlsZSI6ImluZGV4LmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZmluZCwgbWFwVmFsdWVzLCBhc3NpZ24gfSBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IGFjdGlvbkNyZWF0b3JGYWN0b3J5LCB7IGlzVHlwZSwgQWN0aW9uLCBBbnlBY3Rpb24sIEFjdGlvbkNyZWF0b3IgfSBmcm9tIFwidHlwZXNjcmlwdC1mc2FcIjtcbmltcG9ydCB7IFJlZHVjZXIgfSBmcm9tICdyZWR1eCc7XG5cbmV4cG9ydCB7IEFjdGlvbiwgQW55QWN0aW9uLCBBY3Rpb25DcmVhdG9yIH07XG5cbmV4cG9ydCBpbnRlcmZhY2UgQWN0aW9uQ3JlYXRvcldpdGhSZWR1Y2VyPFN0YXRlVHlwZT4ge1xuICAgIGFjdGlvbkNyZWF0b3I6IEFjdGlvbkNyZWF0b3I8YW55PjtcbiAgICByZWR1Y2VyOiAoc3RhdGU6IFN0YXRlVHlwZSwgYWN0aW9uOiBhbnkpID0+IFN0YXRlVHlwZTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBBY3Rpb25DcmVhdG9yV2l0aFJlZHVjZXJHcm91cDxTdGF0ZVR5cGU+IHtcbiAgICBba2V5OiBzdHJpbmddOiBBY3Rpb25DcmVhdG9yV2l0aFJlZHVjZXI8U3RhdGVUeXBlPjtcbn1cbiBcbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVSZWR1Y2VyPFN0YXRlVHlwZT4oaW5pdGlhbFN0YXRlOiBTdGF0ZVR5cGUsIGFjdGlvbnM6IEFjdGlvbkNyZWF0b3JXaXRoUmVkdWNlckdyb3VwPFN0YXRlVHlwZT4pIHtcbiAgICByZXR1cm4gKHN0YXRlOiBTdGF0ZVR5cGUgPSBpbml0aWFsU3RhdGUsIGluY29taW5nQWN0aW9uOiBBY3Rpb248QW55QWN0aW9uPik6IFN0YXRlVHlwZSA9PiB7XG4gICAgICAgIGNvbnN0IGFjdGlvbk1hdGNoID0gZmluZChhY3Rpb25zLCBhY3Rpb24gPT4ge1xuICAgICAgICAgICAgcmV0dXJuIGlzVHlwZShpbmNvbWluZ0FjdGlvbiwgYWN0aW9uLmFjdGlvbkNyZWF0b3IpO1xuICAgICAgICB9KTtcbiAgICAgICAgaWYgKGFjdGlvbk1hdGNoKSB7XG4gICAgICAgICAgICByZXR1cm4gYWN0aW9uTWF0Y2gucmVkdWNlcihzdGF0ZSwgaW5jb21pbmdBY3Rpb24ucGF5bG9hZCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gc3RhdGU7XG4gICAgICAgIH1cbiAgICB9O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFN0YXRlVHlwZVJlZHVjZXI8U3RhdGVUeXBlLCBBY3Rpb25QYXJhbXM+IHtcbiAgICAoc3RhdGU6IFN0YXRlVHlwZSwgYWN0aW9uOiBBY3Rpb25QYXJhbXMpOiBTdGF0ZVR5cGU7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBtYWtlQWN0aW9uQ3JlYXRvcldpdGhSZWR1Y2VyPFN0YXRlVHlwZSwgQWN0aW9uUGFyYW1zPihuYW1lOiBzdHJpbmcsIHJlZHVjZXI6IFN0YXRlVHlwZVJlZHVjZXI8U3RhdGVUeXBlLCBBY3Rpb25QYXJhbXM+KSB7XG4gICAgY29uc3QgU2ltcGxlQWN0aW9uQ3JlYXRvciA9IGFjdGlvbkNyZWF0b3JGYWN0b3J5KCk7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgYWN0aW9uQ3JlYXRvcjogU2ltcGxlQWN0aW9uQ3JlYXRvcjxBY3Rpb25QYXJhbXM+KG5hbWUpLFxuICAgICAgICByZWR1Y2VyXG4gICAgfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldENyZWF0b3JzPFQgZXh0ZW5kcyB7IFtrZXk6IHN0cmluZ106IEFjdGlvbkNyZWF0b3JXaXRoUmVkdWNlcjxhbnk+IH0+KGNyZWF0b3JzOiBUKTogeyBbUCBpbiBrZXlvZiBUXTogVFtQXVsnYWN0aW9uQ3JlYXRvciddIH0ge1xuICAgIHJldHVybiBtYXBWYWx1ZXMoY3JlYXRvcnMsIFwiYWN0aW9uQ3JlYXRvclwiKSBhcyB7IFtQIGluIGtleW9mIFRdOiBUW1BdWydhY3Rpb25DcmVhdG9yJ10gfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG1ha2VBY3Rpb25DcmVhdG9yV2l0aFJlZHVjZXJXaXRoUHJlZml4PFN0YXRlVHlwZSwgQWN0aW9uUGFyYW1zPihhY3Rpb25OYW1lOiBzdHJpbmcsIHJlZHVjZXI6IFN0YXRlVHlwZVJlZHVjZXI8U3RhdGVUeXBlLCBBY3Rpb25QYXJhbXM+KSB7XG4gICAgcmV0dXJuIChyZWR1Y2VyTmFtZT86IHN0cmluZykgPT4gbWFrZUFjdGlvbkNyZWF0b3JXaXRoUmVkdWNlcjxTdGF0ZVR5cGUsIEFjdGlvblBhcmFtcz4oSlNPTi5zdHJpbmdpZnkoeyByZWR1Y2VyTmFtZSwgYWN0aW9uTmFtZSB9KSwgcmVkdWNlcik7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2ltcGxlQW5kVGh1bmtBY3Rpb25zIHtcbiAgICBba2V5OiBzdHJpbmddOiBhbnk7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQWN0aW9uc0FuZFJlZHVjZXIge1xuICAgIGFjdGlvbnM/OiBTaW1wbGVBbmRUaHVua0FjdGlvbnM7XG4gICAgcmVkdWNlcj86IFJlZHVjZXI8YW55LCBBbnlBY3Rpb24+O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0UmVkdWNlcnNGcm9tQ29tYmluZWRBY3Rpb25SZWR1Y2VyPFQgZXh0ZW5kcyB7IFtrZXk6IHN0cmluZ106IEFjdGlvbnNBbmRSZWR1Y2VyIH0+KGNyZWF0b3JzOiBUKTogeyBbUCBpbiBrZXlvZiBUXTogVFtQXVsncmVkdWNlciddIH0ge1xuICAgIHJldHVybiBtYXBWYWx1ZXMoY3JlYXRvcnMsIFwicmVkdWNlclwiKSBhcyB7IFtQIGluIGtleW9mIFRdOiBUW1BdWydyZWR1Y2VyJ10gfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldEFjdGlvbnNGcm9tQ29tYmluZWRBY3Rpb25SZWR1Y2VyPFQgZXh0ZW5kcyB7IFtrZXk6IHN0cmluZ106IEFjdGlvbnNBbmRSZWR1Y2VyIH0+KGNyZWF0b3JzOiBUKTogeyBbUCBpbiBrZXlvZiBUXTogVFtQXVsnYWN0aW9ucyddIH0ge1xuICAgIHJldHVybiBtYXBWYWx1ZXMoY3JlYXRvcnMsIFwiYWN0aW9uc1wiKSBhcyB7IFtQIGluIGtleW9mIFRdOiBUW1BdWydhY3Rpb25zJ10gfTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBBY3Rpb25zQW5kUmVkdWNlclNldHVwIHtcbiAgICBba2V5OiBzdHJpbmddOiBBY3Rpb25zQW5kUmVkdWNlcjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBBY3Rpb25zUmVkdWNlcnNGcm9tQ29tYmluZWRBY3Rpb25SZWR1Y2VyPEFjdGlvbnNSZWR1Y2Vyc0luc3RhbmNlcyBleHRlbmRzIEFjdGlvbnNBbmRSZWR1Y2VyU2V0dXA+IHtcbiAgICBhY3Rpb25zOiB7IFtQIGluIGtleW9mIEFjdGlvbnNSZWR1Y2Vyc0luc3RhbmNlc106IEFjdGlvbnNSZWR1Y2Vyc0luc3RhbmNlc1tQXVsnYWN0aW9ucyddIH07XG4gICAgcmVkdWNlcnM6IHsgW1AgaW4ga2V5b2YgQWN0aW9uc1JlZHVjZXJzSW5zdGFuY2VzXTogQWN0aW9uc1JlZHVjZXJzSW5zdGFuY2VzW1BdWydyZWR1Y2VyJ10gfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldEFjdGlvbnNBbmRSZWR1Y2Vyc0Zyb21Db21iaW5lZEFjdGlvblJlZHVjZXI8Q3JlYXRvcnMgZXh0ZW5kcyBBY3Rpb25zQW5kUmVkdWNlclNldHVwPihjcmVhdG9yczogQ3JlYXRvcnMpOiBBY3Rpb25zUmVkdWNlcnNGcm9tQ29tYmluZWRBY3Rpb25SZWR1Y2VyPENyZWF0b3JzPiB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgYWN0aW9uczogZ2V0QWN0aW9uc0Zyb21Db21iaW5lZEFjdGlvblJlZHVjZXIoY3JlYXRvcnMpIGFzIHsgW1AgaW4ga2V5b2YgQ3JlYXRvcnNdOiBDcmVhdG9yc1tQXVsnYWN0aW9ucyddIH0sXG4gICAgICAgIHJlZHVjZXJzOiBnZXRSZWR1Y2Vyc0Zyb21Db21iaW5lZEFjdGlvblJlZHVjZXIoY3JlYXRvcnMpIGFzIHsgW1AgaW4ga2V5b2YgQ3JlYXRvcnNdOiBDcmVhdG9yc1tQXVsncmVkdWNlciddIH1cbiAgICB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdGVzdFJ1bm5lcjxSZWR1Y2VyU3RhdGU+KHJlZHVjZXI6IFJlZHVjZXIpIHtcbiAgICByZXR1cm4gKGluaXRhbFN0YXRlOiBSZWR1Y2VyU3RhdGUsIGFjdGlvbjogQW55QWN0aW9uKSA9PiB7XG4gICAgICAgIHJldHVybiByZWR1Y2VyKGluaXRhbFN0YXRlLCBhY3Rpb24pO1xuICAgIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBtYWtlU2ltcGxlUmVkdWNlcjxTdGF0ZSBleHRlbmRzIHt9PihuYW1lOiBzdHJpbmcsIGluaXRpYWxTdGF0ZTogU3RhdGUpIHtcbiAgICBjb25zdCByZWR1Y2VyTmFtZSA9IG5hbWUgPyBuYW1lIDogJ3JhbmRvbSc7XG4gICAgY29uc3QgYWN0aW9ucyA9IG1hcFZhbHVlcyhpbml0aWFsU3RhdGUsIChwcm9wZXJ0eUZyb21TdGF0ZSwga2V5OiBrZXlvZiBTdGF0ZSkgPT4ge1xuICAgICAgICBjb25zdCBjcmVhdG9yUmVkdWNlciA9IG1ha2VBY3Rpb25DcmVhdG9yV2l0aFJlZHVjZXJXaXRoUHJlZml4PFN0YXRlLCBTdGF0ZVt0eXBlb2Yga2V5XT4oXG4gICAgICAgICAgICBgVVBEQVRFXyR7a2V5LnRvVXBwZXJDYXNlKCl9YCxcbiAgICAgICAgICAgIChzdGF0ZSwgbmV3VmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYXNzaWduKHt9LCBzdGF0ZSxcbiAgICAgICAgICAgICAgICAgICAge1trZXldOiBuZXdWYWx1ZX1cbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICApO1xuICAgICAgICByZXR1cm4gY3JlYXRvclJlZHVjZXIocmVkdWNlck5hbWUpIGFzIGFueTtcbiAgICB9KSBhcyB7XG4gICAgICAgIFtQIGluIGtleW9mIFN0YXRlXToge1xuICAgICAgICAgICAgYWN0aW9uQ3JlYXRvcjogQWN0aW9uQ3JlYXRvcjxTdGF0ZVtQXT47XG4gICAgICAgICAgICByZWR1Y2VyOiBTdGF0ZVR5cGVSZWR1Y2VyPFN0YXRlLCBTdGF0ZVtQXT47XG4gICAgICAgIH1cbiAgICB9O1xuICAgIGNvbnN0IHJlc2V0ID0gbWFrZUFjdGlvbkNyZWF0b3JXaXRoUmVkdWNlcldpdGhQcmVmaXg8U3RhdGUsIHt9PihcbiAgICAgICAgYFJFU0VUYCxcbiAgICAgICAgKCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIGluaXRpYWxTdGF0ZTtcbiAgICAgICAgfVxuICAgICkocmVkdWNlck5hbWUpO1xuICAgIGNvbnN0IHNldEFsbCA9IG1ha2VBY3Rpb25DcmVhdG9yV2l0aFJlZHVjZXJXaXRoUHJlZml4PFN0YXRlLCBTdGF0ZT4oXG4gICAgICAgIGBTRVRfQUxMYCxcbiAgICAgICAgKHN0YXRlLCBuZXdWYWx1ZSkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIG5ld1ZhbHVlO1xuICAgICAgICB9XG4gICAgKShyZWR1Y2VyTmFtZSk7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgYWN0aW9uczogYXNzaWduKHt9LCBcbiAgICAgICAgICAgIGdldENyZWF0b3JzKGFzc2lnbih7fSwgYWN0aW9ucywge3Jlc2V0LCBzZXRBbGx9KSksXG4gICAgICAgICksXG4gICAgICAgIHJlZHVjZXI6IGNyZWF0ZVJlZHVjZXI8U3RhdGU+KGluaXRpYWxTdGF0ZSwgYXNzaWduKHt9LCBhY3Rpb25zLCB7cmVzZXQsIHNldEFsbH0pKVxuICAgIH07XG59XG4iXX0=
